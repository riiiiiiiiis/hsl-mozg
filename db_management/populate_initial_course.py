import os
import sys
import psycopg2

# –≠—Ç–æ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã —Å–∫—Ä–∏–ø—Ç –º–æ–≥ –Ω–∞–π—Ç–∏ –≤–∞—à —Ñ–∞–π–ª config.py
sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), '..')))
import config

def main():
    """–î–æ–±–∞–≤–ª—è–µ—Ç –∫—É—Ä—Å—ã '–í–∞–π–± –∫–æ–¥–∏–Ω–≥' –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö."""
    conn = None
    try:
        conn = psycopg2.connect(config.DATABASE_URL)
        print("–£—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–∏–ª–∏—Å—å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.")
    except Exception as e:
        print(f"–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env –∏ –∑–∞–ø—É—â–µ–Ω –ª–∏ Docker. –û—à–∏–±–∫–∞: {e}")
        return
    
    # –û–ø–∏—Å–∞–Ω–∏—è –∫—É—Ä—Å–æ–≤
    core_description = "‚úåÔ∏è –í–¢–û–†–û–ô –ü–û–¢–û–ö –í–ê–ô–ë–ö–û–î–ò–ù–ì–ê\n\n\"–Ø –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–æ–≤–∞–ª–∞—Å—å –≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ. –ö—É—Ä—Å –æ—Ç–∫—Ä—ã–ª –¥—Ä—É–≥–æ–π –º–∏—Ä\" ‚Äî –†–∞–¥–∏—Å–ª–∞–≤–∞\n\"–ù–∞–≤–∞–π–±–∫–æ–¥–∏–ª–∞ –º—É–∂—É —Å–∞–π—Ç\" ‚Äî –ù–∞—Å—Ç—è\n\n–ù–∞—É—á–∏—Ç–µ—Å—å —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–∞–π—Ç—ã, –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ Telegram-–±–æ—Ç–æ–≤ —á–µ—Ä–µ–∑ –¥–∏–∞–ª–æ–≥ —Å AI\n\n+ –æ—Å–≤–æ–∏—Ç–µ –ø—Ä–æ–º–ø—Ç-–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥ –∏ –ø–æ–π–º—ë—Ç–µ –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω—ã —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ AI –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è\n\nüéØ –ë–ï–ó –ù–ê–í–´–ö–û–í –ü–†–û–ì–†–ê–ú–ú–ò–†–û–í–ê–ù–ò–Ø\n\nüìö –§–û–†–ú–ê–¢:\n‚Ä¢ –í–∏–¥–µ–æ-—É—Ä–æ–∫–∏ + —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã\n‚Ä¢ 3 –ª–∞–π–≤–∞ —Å –ø—Ä–∞–∫—Ç–∏–∫–æ–π\n‚Ä¢ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –¥–æ–º–∞—à–∫–∏ —Å —Ä–∞–∑–±–æ—Ä–æ–º\n‚Ä¢ –î–æ—Å—Ç—É–ø –∫ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º –Ω–∞–≤—Å–µ–≥–¥–∞\n\nüõ† –ò–°–ü–û–õ–¨–ó–£–ï–ú:\n–ü–æ—Å–ª–µ–¥–Ω–∏–µ –º–æ–¥–µ–ª–∏: OpenAI o3, Google Gemini 2.5 Pro, Anthropic Claude Sonnet 4\n–í–∞–π–±–∫–æ–¥–µ—Ä—Å–∫–∏–µ –∞–ø–ø—ã: Cursor, Windsurf, Bolt, Gemini CLI\n\nüí∞ CORE ($100):\n‚Ä¢ –í—Å–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∏ –∑–∞–ø–∏—Å–∏\n‚Ä¢ –ó–∞–∫—Ä—ã—Ç—ã–π —á–∞—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π\n‚Ä¢ –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –ø–æ –¥–æ–º–∞—à–∫–∞–º\n\nüìÖ –°—Ç–∞—Ä—Ç: 23 –∏—é–ª—è\n‚è∞ –ó–∞–Ω—è—Ç–∏—è –ø–æ —Å—Ä–µ–¥–∞–º –≤ 21:00 –ø–æ –º—Å–∫\n\n–û–ø–ª–∞—Ç–∞ –≤–æ–∑–º–æ–∂–Ω–∞ –ø–µ—Ä–µ–≤–æ–¥–æ–º –Ω–∞ –∫–∞—Ä—Ç—ã –¢-–ë–∞–Ω–∫–∞, –ö–∞—Å–ø–∏, –≤ –ø–µ—Å–æ –∏–ª–∏ USDT –Ω–∞ –∫—Ä–∏–ø—Ç–æ –∫–æ—à–µ–ª–µ–∫."

    extra_description = "‚úåÔ∏è –í–¢–û–†–û–ô –ü–û–¢–û–ö –í–ê–ô–ë–ö–û–î–ò–ù–ì–ê (–†–ê–°–®–ò–†–ï–ù–ù–´–ô)\n\n\"–Ø –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–æ–≤–∞–ª–∞—Å—å –≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ. –ö—É—Ä—Å –æ—Ç–∫—Ä—ã–ª –¥—Ä—É–≥–æ–π –º–∏—Ä\" ‚Äî –†–∞–¥–∏—Å–ª–∞–≤–∞\n\"–ù–∞–≤–∞–π–±–∫–æ–¥–∏–ª–∞ –º—É–∂—É —Å–∞–π—Ç\" ‚Äî –ù–∞—Å—Ç—è\n\n–ù–∞—É—á–∏—Ç–µ—Å—å —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–∞–π—Ç—ã, –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ Telegram-–±–æ—Ç–æ–≤ —á–µ—Ä–µ–∑ –¥–∏–∞–ª–æ–≥ —Å AI\n\n+ –æ—Å–≤–æ–∏—Ç–µ –ø—Ä–æ–º–ø—Ç-–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥ –∏ –ø–æ–π–º—ë—Ç–µ –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω—ã —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ AI –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è\n\nüéØ –ë–ï–ó –ù–ê–í–´–ö–û–í –ü–†–û–ì–†–ê–ú–ú–ò–†–û–í–ê–ù–ò–Ø\n\nüìö –§–û–†–ú–ê–¢:\n‚Ä¢ –í–∏–¥–µ–æ-—É—Ä–æ–∫–∏ + —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã\n‚Ä¢ 3 –ª–∞–π–≤–∞ —Å –ø—Ä–∞–∫—Ç–∏–∫–æ–π\n‚Ä¢ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –¥–æ–º–∞—à–∫–∏ —Å —Ä–∞–∑–±–æ—Ä–æ–º\n‚Ä¢ –î–æ—Å—Ç—É–ø –∫ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º –Ω–∞–≤—Å–µ–≥–¥–∞\n\nüõ† –ò–°–ü–û–õ–¨–ó–£–ï–ú:\n–ü–æ—Å–ª–µ–¥–Ω–∏–µ –º–æ–¥–µ–ª–∏: OpenAI o3, Google Gemini 2.5 Pro, Anthropic Claude Sonnet 4\n–í–∞–π–±–∫–æ–¥–µ—Ä—Å–∫–∏–µ –∞–ø–ø—ã: Cursor, Windsurf, Bolt, Gemini CLI\n\n‚≠ê EXTRA ($200):\n‚Ä¢ –í—Å—ë –∏–∑ –±–∞–∑–æ–≤–æ–≥–æ CORE +\n‚Ä¢ –î–æ—Å—Ç—É–ø –≤ –ª–∏—á–∫—É –Ω–∞ –≤—Ä–µ–º—è –∫—É—Ä—Å–∞\n‚Ä¢ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–µ –∑–∞–Ω—è—Ç–∏–µ –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è\n\nüìÖ –°—Ç–∞—Ä—Ç: 23 –∏—é–ª—è\n‚è∞ –ó–∞–Ω—è—Ç–∏—è –ø–æ —Å—Ä–µ–¥–∞–º –≤ 21:00 –ø–æ –º—Å–∫\n\n–û–ø–ª–∞—Ç–∞ –≤–æ–∑–º–æ–∂–Ω–∞ –ø–µ—Ä–µ–≤–æ–¥–æ–º –Ω–∞ –∫–∞—Ä—Ç—ã –¢-–ë–∞–Ω–∫–∞, –ö–∞—Å–ø–∏, –≤ –ø–µ—Å–æ –∏–ª–∏ USDT –Ω–∞ –∫—Ä–∏–ø—Ç–æ –∫–æ—à–µ–ª–µ–∫."

    courses_data = [
        {
            "id": 1,
            "name": "–í–∞–π–± –∫–æ–¥–∏–Ω–≥",
            "description": core_description,
            "price_usd_cents": 10000,  # $100
            "button_text": "–í–∞–π–± –ö–æ–¥–∏–Ω–≥ CORE - $100",
            "is_active": True,
            "start_date_text": "23 –∏—é–ª—è"
        },
        {
            "id": 2,
            "name": "–í–∞–π–± –∫–æ–¥–∏–Ω–≥ EXTRA",
            "description": extra_description,
            "price_usd_cents": 20000,  # $200
            "button_text": "–í–∞–π–± –ö–æ–¥–∏–Ω–≥ EXTRA - $200",
            "is_active": True,
            "start_date_text": "23 –∏—é–ª—è"
        }
    ]

    try:
        with conn.cursor() as cur:
            # –°–Ω–∞—á–∞–ª–∞ —É–±–µ–¥–∏–º—Å—è, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ courses —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            cur.execute("SELECT to_regclass('public.courses');")
            if cur.fetchone()[0] is None:
                print("–û–®–ò–ë–ö–ê: –¢–∞–±–ª–∏—Ü–∞ 'courses' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–Ω–∞—á–∞–ª–∞ 'python bot.py', —á—Ç–æ–±—ã –æ–Ω —Å–æ–∑–¥–∞–ª –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã.")
                return

            # –û–±–Ω–æ–≤–ª—è–µ–º –∏–ª–∏ –¥–æ–±–∞–≤–ª—è–µ–º –∫–∞–∂–¥—ã–π –∫—É—Ä—Å
            for course_data in courses_data:
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –∫—É—Ä—Å —Å —Ç–∞–∫–∏–º ID
                cur.execute("SELECT id FROM courses WHERE id = %s", (course_data['id'],))
                existing_course = cur.fetchone()
                
                if existing_course:
                    print(f"–ö—É—Ä—Å —Å ID {course_data['id']} —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –û–±–Ω–æ–≤–ª—è–µ–º...")
                    cur.execute("""
                        UPDATE courses 
                        SET name = %(name)s, description = %(description)s, price_usd_cents = %(price_usd_cents)s, 
                            button_text = %(button_text)s, is_active = %(is_active)s, start_date_text = %(start_date_text)s
                        WHERE id = %(id)s
                    """, course_data)
                    print(f"–û–ë–ù–û–í–õ–Å–ù –∫—É—Ä—Å '{course_data['name']}'")
                else:
                    # –ï—Å–ª–∏ –∫—É—Ä—Å–∞ –Ω–µ—Ç, –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ
                    print(f"–ö—É—Ä—Å '{course_data['name']}' –Ω–µ –Ω–∞–π–¥–µ–Ω, –¥–æ–±–∞–≤–ª—è–µ–º –≤ –±–∞–∑—É...")
                    cur.execute("""
                        INSERT INTO courses (id, name, description, price_usd_cents, button_text, is_active, start_date_text)
                        VALUES (%(id)s, %(name)s, %(description)s, %(price_usd_cents)s, %(button_text)s, %(is_active)s, %(start_date_text)s)
                    """, course_data)
                    print(f"–î–û–ë–ê–í–õ–ï–ù –∫—É—Ä—Å '{course_data['name']}'")
            
            conn.commit()
            print("–£–°–ü–ï–•! –í—Å–µ –∫—É—Ä—Å—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.")
            
    except Exception as e:
        print(f"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö: {e}")
        if conn:
            conn.rollback()
    finally:
        if conn:
            conn.close()

if __name__ == "__main__":
    main()